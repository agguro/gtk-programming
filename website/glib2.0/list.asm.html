<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>list.asm</title>
</head>
<!-- Highlighting: "Intel x86 (NASM)" -->
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<span style='color:#898887;'>; Name        : list.asm</span>
<span style='color:#898887;'>;</span>
<span style='color:#898887;'>; Build       : aclocal &amp;&amp; autoconf &amp;&amp; automake --add-missing --foreign</span>
<span style='color:#898887;'>;               mkdir build</span>
<span style='color:#898887;'>;               cd build</span>
<span style='color:#898887;'>;               ../configure</span>
<span style='color:#898887;'>;               make</span>
<span style='color:#898887;'>;</span>
<span style='color:#898887;'>; Description : an example of glib 2.0 single linked lists</span>
<span style='color:#898887;'>;</span>
<span style='color:#898887;'>; Source      : https://github.com/steshaw/gtk-examples    </span>

<b>bits</b><span style='color:#b08000;'> 64</span>

[list -]
    <b>extern</b>    g_slist_append
    <b>extern</b>    g_slist_free
    <b>extern</b>    g_slist_insert
    <b>extern</b>    g_slist_insert_sorted
    <b>extern</b>    g_slist_prepend
    <b>extern</b>    g_slist_reverse
    <b>extern</b>    g_slist_sort
    <b>extern</b>    g_slist_nth
    <b>extern</b>    g_slist_find
    <b>extern</b>    g_print
    <b>extern</b>    strcmp
    <b>extern</b>    exit
[list +]

<b>section</b> .rodata
<span style='color:#644a9b;'>    names:</span>
<span style='color:#644a9b;'>    .fred:</span>    <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Fred&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .susie:</span>   <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Susie&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .frank:</span>   <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Frank&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .wilma:</span>   <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Wilma&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .mary:</span>    <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Mary&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .joe:</span>     <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Joe&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .mike:</span>    <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Mike&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .tyler:</span>   <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Tyler&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .amy:</span>     <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Amy&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .zoe:</span>     <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;Zoe&quot;</span>,<span style='color:#b08000;'>0</span>

<span style='color:#644a9b;'>    messages:</span>
<span style='color:#644a9b;'>    .original:</span>          <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;original list&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;-------------&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .reversinglist:</span>     <span style='color:#0057ae;'>db</span>    <span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;reversing list&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;--------------&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .reversesorting:</span>    <span style='color:#0057ae;'>db</span>    <span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;reverse sorted list&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;-------------------&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .sorting:</span>           <span style='color:#0057ae;'>db</span>    <span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;sorted list&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#bf0303;'>&quot;-----------&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .notfound:</span>          <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;not found.&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .found:</span>             <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;found at %d.&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .item:</span>              <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;%s &quot;</span>               <span style='color:#898887;'>;don't separate this line with the next</span>
<span style='color:#644a9b;'>    .crlf:</span>              <span style='color:#0057ae;'>db</span>    <span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>    .lookup:</span>            <span style='color:#0057ae;'>db</span>    <span style='color:#bf0303;'>&quot;looking up %s : &quot;</span>,<span style='color:#b08000;'>0</span>
    
<b>section</b> .data

<span style='color:#644a9b;'>    list:</span>               <span style='color:#0057ae;'>dq</span>    <span style='color:#b08000;'>0</span>            <span style='color:#898887;'>;start of the list</span>
        
<b>section</b> .text
<b>global</b> _start

<span style='color:#644a9b;'>_start:</span>
    <span style='color:#898887;'>;add Fred, Susie, Frank and Wilma to the list</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.fred
    <b>call</b>    g_slist_append
    <b>mov</b>     [list],<b>rax</b>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.susie
    <b>call</b>    g_slist_append
    <b>mov</b>     [list],<b>rax</b>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.frank
    <b>call</b>    g_slist_append
    <b>mov</b>     [list],<b>rax</b>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.wilma
    <b>call</b>    g_slist_append
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;insert Joe at the front of the list</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.<b>jo</b>e
    <b>call</b>    g_slist_prepend
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;insert Mary after the second position</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.mary
    <b>mov</b>     <b>rdx</b>,<span style='color:#b08000;'>2</span>
    <b>call</b>    g_slist_insert
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;add names but sorted</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.amy
    <b>mov</b>     <b>rdx</b>,List.Sort
    <b>call</b>    g_slist_insert_sorted
    <b>mov</b>     [list],<b>rax</b>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.zoe
    <b>mov</b>     <b>rdx</b>,List.Sort
    <b>call</b>    g_slist_insert_sorted
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;Show the list so far</span>
    <b>mov</b>     <b>rdi</b>,messages.original
    <b>xor</b>     <b>rax</b>,<b>rax</b>
    <b>call</b>    g_print
    <b>mov</b>     <b>rdi</b>,[list]
    <b>call</b>    List.Display
    <b>mov</b>     <b>rdi</b>,messages.crlf
    <b>xor</b>     <b>rax</b>,<b>rax</b>
    <b>call</b>    g_print
    <span style='color:#898887;'>;lookup some names in the list</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.mike
    <b>call</b>    List.Lookup
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.mary
    <b>call</b>    List.Lookup
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.fred
    <b>call</b>    List.Lookup
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,names.tyler
    <b>call</b>    List.Lookup
    <span style='color:#898887;'>;reverse the list</span>
    <b>mov</b>     <b>rdi</b>,messages.reversinglist
    <b>call</b>    g_print
    <b>mov</b>     <b>rdi</b>,[list]
    <b>call</b>    g_slist_reverse
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;show revered list</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>call</b>    List.Display
    <span style='color:#898887;'>;sort the list alphabetically</span>
    <b>mov</b>     <b>rdi</b>,messages.sorting
    <b>call</b>    g_print
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,List.Sort
    <b>call</b>    g_slist_sort
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;show sorted list</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>call</b>    List.Display
    <span style='color:#898887;'>;reversesort the list</span>
    <b>mov</b>     <b>rdi</b>,messages.reversesorting
    <b>call</b>    g_print
    <b>mov</b>     <b>rdi</b>,[list]
    <b>mov</b>     <b>rsi</b>,List.ReverseSort
    <b>call</b>    g_slist_sort
    <b>mov</b>     [list],<b>rax</b>
    <span style='color:#898887;'>;show sorted list</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>call</b>    List.Display
    <span style='color:#898887;'>;free the data</span>
    <b>mov</b>     <b>rdi</b>,[list]
    <b>call</b>    g_slist_free
    <span style='color:#898887;'>;exit the program</span>
    <b>xor</b>     <b>rdi</b>,<b>rdi</b>
    <b>call</b>    exit

<span style='color:#644a9b;'>List:</span>
<span style='color:#644a9b;'>.Lookup:</span>
    <span style='color:#898887;'>;int 3</span>
    <span style='color:#898887;'>;rdi has pointer to list</span>
    <span style='color:#898887;'>;rsi has pointer to name which we're looking for</span>
    <b>push</b>    <b>rbp</b>
    <b>mov</b>     <b>rbp</b>,<b>rsp</b>
    <b>push</b>    <b>rdi</b>
    <b>push</b>    <b>rsi</b>
    <b>mov</b>     <b>rdi</b>,messages.lookup
    <b>xor</b>     <b>rax</b>,<b>rax</b>
    <b>call</b>    g_print
    <b>pop</b>     <b>rsi</b>
    <b>pop</b>     <b>rdi</b>
    <b>call</b>    g_slist_find
    <b>mov</b>     <b>rdi</b>,messages.notfound
    <span style='color:#898887;'>;rax has either zero or the item pointer</span>
    <b>and</b>     <b>rax</b>,<b>rax</b>
    <b>jz</b>      .print
    <b>mov</b>     <b>rsi</b>,<b>rax</b>
    <b>mov</b>     <b>rdi</b>,messages.found
    <b>xor</b>     <b>rax</b>,<b>rax</b>
<span style='color:#644a9b;'>.print:</span>    
    <b>call</b>    g_print
    <b>mov</b>     <b>rsp</b>,<b>rbp</b>
    <b>pop</b>     <b>rbp</b>
    <b>ret</b>
    
<span style='color:#644a9b;'>.Display:</span>
    <b>push</b>    <b>rbp</b>
    <b>mov</b>     <b>rbp</b>,<b>rsp</b>
    <b>sub</b>     <b>rsp</b>,<span style='color:#b08000;'>0x0</span>
    <b>mov</b>     <b>r15</b>,<b>rdi</b>
    <b>xor</b>     <b>rsi</b>,<b>rsi</b>                    <span style='color:#898887;'>;index = 0</span>
<span style='color:#644a9b;'>.repeat:</span>
    <b>xor</b>     <b>rax</b>,<b>rax</b>
    <b>mov</b>     <b>rdi</b>,<b>r15</b>
    <b>call</b>    g_slist_nth                <span style='color:#898887;'>;get nth item in the list</span>
    <b>and</b>     <b>rax</b>,<b>rax</b>
    <b>jz</b>      .done
    <b>push</b>    <b>rdi</b>
    <b>push</b>    <b>rsi</b>
    <b>mov</b>     <b>rsi</b>,[<b>rax</b>]
    <b>mov</b>     <b>rdi</b>,messages.item
    <b>xor</b>     <b>rax</b>,<b>rax</b>
    <b>call</b>    g_print
    <b>pop</b>     <b>rsi</b>
    <b>pop</b>     <b>rdi</b>
    <b>inc</b>     <b>esi</b>
    <b>jmp</b>     .repeat
<span style='color:#644a9b;'>.done:</span>
    <b>mov</b>     <b>rsp</b>,<b>rbp</b>
    <b>pop</b>     <b>rbp</b>
    <b>ret</b>
    
<span style='color:#644a9b;'>.ReverseSort:</span>
    <span style='color:#898887;'>;reverse sorting is fairly easy now, just swap rdi and rsi</span>
    <b>xor</b>     <b>rdi</b>,<b>rsi</b>
    <b>xor</b>     <b>rsi</b>,<b>rdi</b>
    <b>xor</b>     <b>rdi</b>,<b>rsi</b>
    <span style='color:#898887;'>;and compare after the swap</span>
<span style='color:#644a9b;'>.Sort:</span>
    <span style='color:#898887;'>;compare strings in rdi and rsi, returning</span>
    <span style='color:#898887;'>;-1 when string rdi comes before string rsi</span>
    <span style='color:#898887;'>; 0 when both strings are equal</span>
    <span style='color:#898887;'>; 1 when string in rsi comes after string rdi</span>
    <b>call</b>    strcmp
    <b>ret</b></pre>
</body>
</html>
