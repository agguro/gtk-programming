<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="Generator" content="Kate, the KDE Advanced Text Editor" />
<title>version.asm</title>
</head>
<!-- Highlighting: "Intel x86 (NASM)" -->
<body>
<pre style='color:#1f1c1b;background-color:#ffffff;'>
<span style='color:#898887;'>; Name        : version.asm</span>
<span style='color:#898887;'>;</span>
<span style='color:#898887;'>; Build       : aclocal &amp;&amp; autoconf &amp;&amp; automake --add-missing --foreign</span>
<span style='color:#898887;'>;               mkdir build</span>
<span style='color:#898887;'>;               cd build</span>
<span style='color:#898887;'>;               ../configure</span>
<span style='color:#898887;'>;               make</span>
<span style='color:#898887;'>;</span>
<span style='color:#898887;'>; Description : The program is restricted to show some data stored in the glib and gtk shared</span>
<span style='color:#898887;'>;				libraries.</span>
<span style='color:#898887;'>;               these strings can be obtained with </span>
<span style='color:#898887;'>;				objdump -t -T /usr/lib/x86_64-linux-gnu/libglib-2.0.so | grep .rodata</span>
<span style='color:#898887;'>;               objdump -t -T /usr/lib/x86_64-linux-gnu/libgtk-x11-2.0.so | grep .rodata</span>
<span style='color:#898887;'>;				and so on for other libraries.</span>
<span style='color:#898887;'>;</span>
<span style='color:#898887;'>; Source  : http://zetcode.com/gui/gtk2/introduction/</span>

<b>bits</b><span style='color:#b08000;'> 64</span>

[list -]
	<span style='color:#898887;'>;glib parameters</span>
	<b>extern</b>	glib_minor_version
	<b>extern</b>	glib_micro_version
	<b>extern</b>	glib_ma<b>jo</b>r_version
	<span style='color:#898887;'>;gtk params</span>
	<b>extern</b>	gtk_micro_version
	<b>extern</b>	gtk_ma<b>jo</b>r_version
	<b>extern</b>	gtk_minor_version
	<span style='color:#898887;'>;stdio</span>
	<b>extern</b>	printf
    <b>extern</b>  exit
[list +]

<b>section</b> .rodata
	<span style='color:#898887;'>;to have the possibility to extend this program I prefer to work with lists</span>

<span style='color:#644a9b;'>	params:</span>	<span style='color:#0057ae;'>dq</span>	glib_ma<b>jo</b>r_version, glib_minor_version,	glib_micro_version	
			<span style='color:#0057ae;'>dq</span>	gtk_ma<b>jo</b>r_version, gtk_minor_version, gtk_micro_version
			<span style='color:#0057ae;'>dq</span>	<span style='color:#b08000;'>0</span>

<span style='color:#644a9b;'>	msgs:</span>	<span style='color:#0057ae;'>dq</span>	szglib_ma<b>jo</b>r_version,szglib_minor_version,szglib_micro_version
			<span style='color:#0057ae;'>dq</span>	szgtk_ma<b>jo</b>r_version, szgtk_minor_version, szgtk_micro_version
	
	<span style='color:#898887;'>;messages:</span>
<span style='color:#644a9b;'>	messages:</span>
<span style='color:#644a9b;'>	szglib_major_version:</span>	<span style='color:#0057ae;'>db</span>	<span style='color:#bf0303;'>&quot;Glib version: %d&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>	szglib_minor_version:</span>	<span style='color:#0057ae;'>db</span>	<span style='color:#bf0303;'>&quot;.%d&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>	szglib_micro_version:</span>	<span style='color:#0057ae;'>db</span>	<span style='color:#bf0303;'>&quot;.%d&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>

<span style='color:#644a9b;'>	szgtk_major_version:</span>	<span style='color:#0057ae;'>db</span>	<span style='color:#bf0303;'>&quot;Gtk version: %d&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>	szgtk_minor_version:</span>	<span style='color:#0057ae;'>db</span>	<span style='color:#bf0303;'>&quot;.%d&quot;</span>,<span style='color:#b08000;'>0</span>
<span style='color:#644a9b;'>	szgtk_micro_version:</span>	<span style='color:#0057ae;'>db</span>	<span style='color:#bf0303;'>&quot;.%d&quot;</span>,<span style='color:#b08000;'>10</span>,<span style='color:#b08000;'>0</span>

<b>section</b> .text
<b>global</b> _start

<span style='color:#644a9b;'>_start:</span>
	<span style='color:#898887;'>;r14 isn't changed by printf and holds the pointer in the message list</span>
	<b>mov</b> 	<b>r14</b>,msgs
	<span style='color:#898887;'>;r15 isn't changed by printf holds the pointer in the param list</span>
	<b>mov</b>		<b>r15</b>,params
	<span style='color:#898887;'>;we're gonna loop through the parameters in params list until we got the nul pointer</span>
	<span style='color:#898887;'>;at the end and we exit the program</span>
<span style='color:#644a9b;'>.repeat:</span>
	<b>mov</b> 	<b>rax</b>,[<b>r15</b>]
	<b>test</b>	<b>rax</b>,<b>rax</b>
	<b>jz</b>		.exit
	<b>mov</b> 	<b>esi</b>,<span style='color:#0057ae;'>dword</span>[<b>rax</b>]		<span style='color:#898887;'>;read value in esi</span>
	<b>mov</b> 	<b>rdi</b>,<span style='color:#0057ae;'>qword</span>[<b>r14</b>]		<span style='color:#898887;'>;read pointer to message in rdi</span>
	<b>xor</b>		<b>rax</b>,<b>rax</b>				<span style='color:#898887;'>;rax =  indicating no extra parameters</span>
	<b>call</b> 	printf
	<b>add</b> 	<b>r14</b>,<span style='color:#b08000;'>8</span>				<span style='color:#898887;'>;next pointer in msgs list</span>
	<b>add</b> 	<b>r15</b>,<span style='color:#b08000;'>8</span>				<span style='color:#898887;'>;next pointer in params list</span>
	<b>jmp</b>		.repeat
<span style='color:#644a9b;'>.exit:</span>
    <span style='color:#898887;'>;exit program</span>
    <b>xor</b>     <b>rdi</b>,<b>rdi</b>
    <b>call</b>    exit</pre>
</body>
</html>
